# PDF仕様

作成日: 2026-02-17  
対象: `vba/Module_NewProject.bas` と `excel/見積原価管理システム.xlsm`

## 1. 共通仕様

- 生成方式: `Worksheet.ExportAsFixedFormat`
- 形式: PDF (`xlTypePDF`)
- 品質: `xlQualityStandard`
- 保存先: Desktop
  - Mac: `~/Desktop/`
  - Windows: `SpecialFolders("Desktop")`
- ファイル名日付: `yyyymmdd`
- 禁則文字: `\\ / : * ? " < > |` と改行/タブを `_` へ置換

## 2. 帳票別仕様

## P-01 見積書（S表紙）

- 呼出マクロ: `S表紙PDF出力`
- 元シート: `Ｓ表紙`
- 必須入力: `Ｓ表紙!J2`（案件シート名）
- 印刷範囲: `'Ｓ表紙'!$A$1:$I$61`
- ページ設定:
  - Orientation: portrait
  - PaperSize: 9 (A4)
  - Horizontal Center: True
- ファイル名: `見積書_<案件名>_yyyymmdd.pdf`
- 事前確認: 保存確認ダイアログ（Yes/No）

### エラー契約

- `J2` が空 -> 警告で終了
- 出力例外 -> エラーメッセージ表示

## P-02 領収書

- 呼出マクロ: `領収書PDF出力`
- 元シート: `領収書`
- 必須入力: `領収書!J2`（請求ID）
- 印刷範囲: `'領収書'!$A$1:$H$26`
- ページ設定:
  - Orientation: portrait
  - PaperSize: 9 (A4)
- ファイル名: `領収書_<請求ID>_yyyymmdd.pdf`

### エラー契約

- `J2` が空 -> 警告で終了
- 出力例外 -> エラーメッセージ表示

## P-03 発注書/請求書（発注書兼請求書）

- 呼出マクロ: `発注書PDF出力`
- 元シート: `発注書兼請求書`
- 入力セル:
  - `B1` 帳票種別（空なら `発注書`）
  - `D1` 案件ID
  - `G1` 業者ID
- 印刷範囲: `'発注書兼請求書'!$A$1:$I$47`
- ページ設定:
  - Orientation: portrait
  - PaperSize: 9 (A4)
  - Horizontal Center: True
- ファイル名: `<帳票種別>_<案件ID>_<業者ID>_yyyymmdd.pdf`

### エラー契約

- 出力例外 -> エラーメッセージ表示

## 3. 命名規則（正規表現）

- 見積書: `^見積書_.+_\d{8}\.pdf$`
- 領収書: `^領収書_.+_\d{8}\.pdf$`
- 発注書系: `^.+_.+_.+_\d{8}\.pdf$`

## 4. 受入基準

- 3帳票ともPDFが生成される
- 保存先がDesktopである
- ファイル名が命名規則に一致する
- 必須セル空欄時は誤出力せず、警告で停止する

## 5. アプリ移行時の実装ルール

- 生成元はExcelではなくHTMLテンプレートへ置換可
- ただし以下は互換維持する
  - 帳票種別
  - ファイル名規則
  - 必須入力チェック
  - 出力タイミング（ワンクリック）

## 6. 差分検証手順（移行比較用）

1. 同一案件IDでExcel版PDFとアプリ版PDFを出力
2. 次の項目を比較
   - 案件ID
   - 顧客名
   - 金額（税抜/税込/残額）
   - 出力日
3. 差分があれば「仕様差」か「実装差」を分類

