# 見積原価管理システム - ギャップ分析 & 実装計画

> 作成日: 2026-02-11
> 目的: 吉野さんの理想フローと現状システムのギャップを明確化し、解消計画を策定する

---

## 1. 吉野さんの理想フロー

```
① 新規案件が来たら「新規案件」ボタンを押す
② 物件名を入力し、顧客名を選択して、住所を入力する
③ 見積作成画面に移動する
④ 見積を作成したら、見積ナンバーが自動で振り分けられる
```

### 理想の全体フロー（案件ライフサイクル）

```
案件作成 → 見積作成 → 見積提出 → 受注 → 発注 → 施工 → 完工 → 請求 → 入金
   ①②        ③④        ↓         ↓      ↓             ↓       ↓      ↓
  ボタン1つ  自動遷移  PDF出力   ステータス  発注書    ステータス  請求書  消込
  で完了    で即作業   ワンクリック 自動更新  自動生成   自動更新  自動生成 自動反映
```

---

## 2. ギャップ一覧

### A. 業務フローのギャップ（最優先）

| # | 理想 | 現状 | ギャップ | 影響度 |
|---|------|------|---------|-------|
| A-1 | 「新規案件」ボタンを押す | ボタンなし。Excel Claudeに口頭依頼 | VBAマクロまたはWebアプリが必要 | ★★★ |
| A-2 | 物件名入力 + 顧客ドロップダウン選択 | 顧客IDを手入力（C-001等）。ドロップダウンなし | データ入力規則（ドロップダウン）の設定が必要 | ★★★ |
| A-3 | 住所を入力できる | 住所フィールドが案件管理・操作パネルにない | 案件管理に「施工住所」列を追加する必要あり | ★★☆ |
| A-4 | 見積作成画面に自動遷移 | 手動でシートを複製→リネーム→移動 | VBAで自動複製＋シート遷移が必要 | ★★★ |
| A-5 | 見積ナンバー自動採番 | P-001形式だが手動で考えて入力 | 案件管理の最終行から自動計算が必要 | ★★★ |
| A-6 | 見積書PDF出力がワンクリック | 手動でファイル→印刷→PDF | VBAで印刷範囲設定→PDF自動保存 | ★★☆ |

### B. 帳票・ドキュメントのギャップ

| # | 理想 | 現状 | ギャップ | 影響度 |
|---|------|------|---------|-------|
| B-1 | 領収書を発行したい | 領収書テンプレートが存在しない | 新規シート作成が必要 | ★★☆ |
| B-2 | S表紙が案件ごとに切り替わる | P-003にハードコードされている | INDIRECT関数で動的参照に変更が必要 | ★★★ |
| B-3 | 発注書を案件から直接生成 | 発注書兼請求書シートに案件ID・業者IDを手入力 | 案件シートから業者を選択→自動生成の流れが必要 | ★★☆ |

### C. データのギャップ

| # | 理想 | 現状 | ギャップ | 影響度 |
|---|------|------|---------|-------|
| C-1 | ダッシュボードで顧客ランキングが見える | 顧客マスタに2件しかない | 主要取引先の登録が必要 | ★★★ |
| C-2 | 月別の売上推移が見える | 案件データが3件しかない | 過去案件データの投入が必要（Phase 5） | ★★★ |
| C-3 | 業者別の発注状況がわかる | 業者DBに5社のサンプルのみ | 60社以上の協力会社を登録する必要あり | ★★☆ |
| C-4 | ドリルダウンで詳細が見える | ハイパーリンクが未設定 | ダッシュボードから各シートへのリンク設定 | ★☆☆ |

### D. システム基盤のギャップ

| # | 理想 | 現状 | ギャップ | 影響度 |
|---|------|------|---------|-------|
| D-1 | 素人でも迷わず使える | 操作マニュアルはあるが、操作自体が複雑 | ボタン化・ドロップダウン化で操作を簡素化 | ★★★ |
| D-2 | 案件が増えてもシートが散らからない | 案件ごとにシートが増える構造 | 将来的にはDB型（1シートに全案件）への移行検討 | ★☆☆ |
| D-3 | 複数人で同時に使える | Excel単体ファイルで排他制御なし | SharePoint/OneDrive共有 or Webアプリ化 | ★☆☆ |

---

## 3. 実装計画

### 方針の選択肢

| 方針 | メリット | デメリット |
|------|---------|-----------|
| **A. Excel + VBA** | 今のシステムをそのまま拡張。学習コスト低い | VBA開発が必要。Excel Claudeでは作れない |
| **B. Webアプリ化** | 理想フローを完全実現。スマホ対応可 | 開発コスト大。データ移行が必要 |
| **C. 段階的移行** | まずExcel+VBAで最低限→将来Webへ | 二重投資になる可能性 |

→ **推奨: C. 段階的移行**

---

### Step 1: Excel内で今すぐできること（VBA不要）

> 所要時間: 1-2時間
> 担当: Excel Claude または Claude Code

| タスク | 内容 | 効果 |
|--------|------|------|
| 1-1 | 案件管理に「施工住所」列を追加（AE列） | フロー②の住所入力に対応 |
| 1-2 | 操作パネルの顧客ID欄にデータ入力規則（ドロップダウン）を設定 | フロー②の顧客選択に対応 |
| 1-3 | S表紙のINDIRECT化（I36〜I55の20セルを動的参照に変更） | 案件切替の手動書換えが不要に |
| 1-4 | 案件管理に自動採番数式を追加（次のP-XXXを自動表示） | フロー④の見積番号自動化の準備 |
| 1-5 | 領収書テンプレートシートを新規作成 | 領収書発行に対応 |
| 1-6 | ダッシュボードにハイパーリンク設置 | ドリルダウン機能 |

### Step 2: VBAマクロ開発（ボタン操作の実現）

> 所要時間: 3-5時間
> 担当: Claude Code（VBAコード生成）→ Excelに貼り付け

| タスク | 内容 | 効果 |
|--------|------|------|
| 2-1 | **「新規案件作成」ボタン + VBA** | ボタン1つで案件シート自動作成 |
| 2-2 | 入力フォーム（UserForm）作成 | 物件名・顧客選択・住所の入力画面 |
| 2-3 | 自動採番ロジック | 案件管理の最終行+1でP-XXX自動生成 |
| 2-4 | シート自動複製 + リネーム + 初期値セット | 案件テンプレートを自動展開 |
| 2-5 | 作成後に新シートへ自動遷移 | フロー③の自動遷移 |
| 2-6 | PDF出力ボタン | S表紙のPDF自動保存 |

#### VBAマクロの処理フロー（Step 2完成イメージ）

```
[新規案件] ボタン押下
    │
    ▼
┌─────────────────────────┐
│   入力フォーム表示        │
│  ┌───────────────────┐  │
│  │ 物件名: [________] │  │
│  │ 顧客:  [▼ 選択  ] │  │
│  │ 住所:  [________] │  │
│  │ 担当者: [▼ 選択  ] │  │
│  │ 目標粗利率: [25%]  │  │
│  └───────────────────┘  │
│     [作成] [キャンセル]    │
└─────────┬───────────────┘
          │
          ▼
    ① 案件管理の最終P-XXXを取得
    ② 次番号 P-XXX+1 を自動採番
    ③ 案件テンプレートをコピー
    ④ シート名を「P-004_物件名」にリネーム
    ⑤ 案件管理に新行を追加
    ⑥ S表紙のJ2にシート名をセット
    ⑦ 新シートに自動遷移
          │
          ▼
    見積作成開始（即作業可能）
```

### Step 3: データ投入（Phase 5）

> 所要時間: 吉野さんのデータ提供次第
> 担当: 吉野さん + Claude（入力補助）

| タスク | 内容 | 必要なデータ |
|--------|------|------------|
| 3-1 | 顧客マスタに主要取引先を登録 | 矢島不動産管理、一建設、フィガロ等の情報 |
| 3-2 | 業者DBに協力会社を登録 | 60社以上の業者名・連絡先・業種・支払条件 |
| 3-3 | 過去案件の登録（最低20件） | 第3期の主要案件の見積金額・原価・顧客・ステータス |
| 3-4 | 工事項目DBの単価を実績値に更新 | 実際の発注単価 |

### Step 4: 将来的なWebアプリ化（オプション）

> 時期: Excel運用が安定した後（3-6ヶ月後目安）
> 担当: 開発者

| タスク | 内容 |
|--------|------|
| 4-1 | ExcelのDB構造をそのままDBスキーマに変換 |
| 4-2 | 管理会社ポータル（別途設計書あり）との統合検討 |
| 4-3 | スマホ対応（現場から見積確認・ステータス更新） |
| 4-4 | 複数ユーザー同時利用対応 |

---

## 4. 優先順位マトリックス

```
影響度 高 ┃  A-1 ボタン化      A-5 自動採番
          ┃  A-2 ドロップダウン  A-4 自動遷移
          ┃  B-2 S表紙動的化   C-1 顧客登録
          ┃  C-2 過去データ     D-1 操作簡素化
          ┃─────────────────────────────────
影響度 中 ┃  A-3 住所欄追加    A-6 PDF出力
          ┃  B-1 領収書        B-3 発注書連携
          ┃  C-3 業者DB登録
          ┃─────────────────────────────────
影響度 低 ┃  C-4 ドリルダウン   D-2 DB型移行
          ┃  D-3 複数人対応
          ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
              VBA不要で対応可      VBA/開発が必要
```

---

## 5. 実行スケジュール案

```
Week 1  ──── Step 1（Excel内改善・VBA不要）
              ├── S表紙 INDIRECT化
              ├── ドロップダウン設定
              ├── 自動採番数式
              ├── 領収書テンプレート
              └── 施工住所列追加

Week 2  ──── Step 2（VBAマクロ開発）
              ├── 新規案件作成ボタン
              ├── 入力フォーム（UserForm）
              ├── シート自動複製ロジック
              └── PDF出力ボタン

Week 3-4 ─── Step 3（データ投入）
              ├── 顧客マスタ登録
              ├── 業者DB登録
              └── 過去案件データ入力

Month 2+ ─── 運用開始・改善サイクル
              ├── 実運用で見つかる課題の修正
              ├── ダッシュボード分析の活用開始
              └── Webアプリ化の検討開始
```

---

## 6. 次のアクション

### 今すぐ実行可能（Claude Code / Excel Claude）

1. **S表紙のINDIRECT化**（20セルの数式変更）
2. **操作パネルに顧客ドロップダウン設定**
3. **案件管理に自動採番セル追加**
4. **領収書テンプレート作成**

### 吉野さんのアクションが必要

5. **VBAマクロの方針決定**（Excel+VBA で進めるか、Webアプリ化するか）
6. **顧客マスタのデータ提供**（取引先名・連絡先・住所）
7. **業者DBのデータ提供**（協力会社60社以上の情報）
8. **過去案件データの提供**（第3期の案件一覧）

---

> このドキュメントは GitHub リポジトリ `link-estimate-system/docs/` で管理されています。
> 進捗に応じて更新してください。
