# 見積原価管理システム 現状分析

> 分析日: 2026-02-11
> 対象: 見積原価管理システム.xlsx（42シート）

---

## 1. システム全体像

### シート一覧（42シート: 可視23 + 非表示19）

#### 可視シート（23枚）

| # | シート名 | レイヤー | 行数 | 列数 | 状態 |
|---|---------|---------|------|------|------|
| 1 | 操作パネル | 制御層 | 54 | 8 | ✅ ガイド表示 |
| 2 | ダッシュボード | 分析層 | 70 | 14 | ⚠️ 枠のみ |
| 3 | 案件管理 | 処理層 | 104 | 30(AD) | ✅ 3件登録 |
| 4 | 案件テンプレート | 入力層 | 124 | 18 | ✅ 雛形 |
| 5 | 発注書兼請求書 | 出力層 | 45 | 10 | ✅ 動作中 |
| 6 | P-003_吉野様邸キッチン | 入力層 | 124 | 18 | ✅ 実案件 |
| 7 | 顧客マスタ | 処理層 | 12 | 13 | ⚠️ 2件のみ |
| 8 | マスター設定 | 処理層 | 30 | 12 | ✅ 設定済み |
| 9 | 工事項目DB | 処理層 | 50 | 13 | ✅ 46件 |
| 10 | 業者DB | 処理層 | 15 | 10 | ⚠️ 5社サンプル |
| 11 | 設計書 | 文書 | - | - | 参考資料 |
| 12 | Ｓ表紙 | 出力層 | 65 | 11 | ✅ P-003連携 |
| 13 | 解体工事 | 旧シート | - | - | ⚠️ 未統合 |
| 14 | 造作工事 | 旧シート | - | - | ⚠️ 未統合 |
| 15 | 建具工事 | 旧シート | - | - | ⚠️ 未統合 |
| 16 | 家具 | 旧シート | - | - | ⚠️ 未統合 |
| 17 | 電気設備' | 旧シート | - | - | ⚠️ 未統合 |
| 18 | タイル左官工事 | 旧シート | - | - | ⚠️ 未統合 |
| 19 | 仕上げ工事 | 旧シート | - | - | ⚠️ 未統合 |
| 20 | Claude Log | 文書 | 30 | 5 | 改修履歴 |
| 21 | 工程表 | 出力層 | 26 | 34 | ✅ ガント |
| 22 | 設計図v2 | 文書 | - | - | 参考資料 |
| 23 | 設計図v3 | 文書 | 145 | 11 | 最新設計書 |

#### 非表示シート（19枚）

| カテゴリ | シート名 |
|---------|---------|
| 旧帳票 | 請求書, 請書(2), 実行予算雛形, 注文書(控), 注文書, 請書 |
| 旧工種 | 産廃費, 仮設, 解体後補修箇所, 新規壁工事, 下地工事, 床, 空調, 雑工事, シート工事, 衛生設備, 塗装工事, 防災工事, ガス工事 |

---

## 2. データフロー（現在の接続状態）

```
【入力】                  【処理】              【出力】
P-003_吉野様邸         案件管理              Ｓ表紙
├─ K50(税込合計) ────→ F7(見積金額)          ├─ I36:I55 ← P-003!B105:B124
├─ G50(原価合計) ────→ G7(実行予算)          ├─ I56 = SUM*マスター設定!K20
└─ B105:B124 ──────────────────────────────→ └─ I59 = SUM*マスター設定!K24
    (カテゴリ別SUMIFS)

工事項目DB ──→ 案件テンプレート             発注書兼請求書
  INDEX+MATCH    ├─ E列(単価自動参照)         ├─ 業者DB → VLOOKUP(宛先)
                 └─ J列(原価逆算A型)          └─ 案件管理 → VLOOKUP(工事名)

顧客マスタ                                   工程表
├─ L列 = COUNTIF(案件管理, 案件数)           └─ P-003用 8工程 ガントチャート
└─ M列 = SUMIFS(案件管理, 受注額)

ダッシュボード
├─ rows 2-15: KPI集計（COUNTIFS/SUMIFS → 案件管理）
├─ rows 17-25: ステータス分布
├─ rows 27-40: 担当者別・滞留案件・失注分析
├─ rows 41-56: 請求・入金管理（枠のみ）
└─ rows 57-70: 受注区分管理（枠のみ）
```

---

## 3. 主要な数式パターン

### 案件管理（30列）

| 列 | 項目 | 数式例 |
|----|------|--------|
| F | 見積金額 | `='P-003_吉野様邸キッチン'!K50` |
| G | 実行予算 | `='P-003_吉野様邸キッチン'!G50` |
| H | 粗利率 | `=IF(AND(F7<>"",G7<>""),(F7-G7)/F7,"")` |
| V | 工期余日 | `=IF(AND(U7<>"",I7<>"⑦完工"),U7-TODAY(),"")` |
| W | 工期アラート | `=IF(V7="","",IF(V7<0,"🔴超過",IF(V7<=7,"🟡注意","🟢順調")))` |
| AD | 受注区分 | `=IF(OR(I7="⑤受注",I7="⑦完工"),"🟢受注",IF(I7="⑥失注","🔴失注","⚪商談中"))` |

### 案件テンプレート（原価計算）

| タイプ | 数式 |
|--------|------|
| A原価逆算 | `=IF(B15="A",IF(AND(F15<>"",I15<>""),ROUND(F15/(1-$B$7),0),""),"")` |
| DB参照 | `=IF(AND(C15<>"",D15<>""),IFERROR(INDEX(工事項目DB!D:D,MATCH(C15&"|"&D15,工事項目DB!K:K,0)),""),"")` |

### Ｓ表紙（経費率 → マスター設定参照）

| 項目 | 数式 |
|------|------|
| 会社経費 | `=SUM(I36:I54)*マスター設定!K20` (10%) |
| 現場経費 | `=SUM(I36:I54)*マスター設定!K21` (5%) |
| 現場管理費 | `=マスター設定!K23*マスター設定!K22` |
| 消費税 | `=SUM(I36:I58)*マスター設定!K24` (10%) |

---

## 4. 根本的な問題点

### 問題1: 二重システムの併存
旧17シート（工種別明細）と新システム（案件テンプレート+DB）が並行して存在。旧シートのデータは新システムに一切流れていない。7シートが可視状態のまま残っており、ユーザーの混乱を招く。

### 問題2: S表紙が1案件にハードコード
`I36='P-003_吉野様邸キッチン'!B105` のように特定シート名を直接参照。案件が変わるたびに全セル（20箇所）の数式を手動で書き換える必要がある。

### 問題3: ダッシュボードがデータ不足で機能しない
案件3件・顧客2件・業者5社のサンプルデータでは、「顧客ランキング」「月別推移」「ドリルダウン」が意味をなさない。最低20〜30件の過去データが必要。

### 問題4: 金流管理が未実装
案件管理にX-AC列（請求書/入金ステータス等）が追加されたが、専用の請求管理・支払管理シートは未作成。ダッシュボードの請求・入金セクション（rows 41-56）も枠のみ。

### 問題5: 案件シート作成が手動
操作パネルに手順は書かれているが、VBA/マクロがないため案件テンプレートの複製・リネーム・案件管理への登録はすべて手作業。案件が増えると運用が破綻する。

---

## 5. 良い点（活かすべき設計）

1. **3タイプの原価計算**（A/B/C）が柔軟で実務に合っている
2. **工事項目DB + 検索キー**（カテゴリ|項目名）による自動参照は効率的
3. **カテゴリ別SUMIFS**（P-003のB105:B124）で20カテゴリの小計を自動集計
4. **マスター設定への経費率集約**で一元管理できている
5. **7段階パイプライン**（リード→完工）のCRM設計は実用的
6. **受注区分・工期アラート**の自動判定ロジックが実装済み
