# MVP画面/API設計

作成日: 2026-02-17  
前提: Phase 0 仕様凍結済み

## 1. MVP対象

- 新規案件作成
- 見積書PDF出力（S表紙相当）
- 領収書PDF出力

## 2. 画面設計（最小）

## S-01 操作パネル（新規案件作成）

### 入力項目

- 顧客ID（select、必須）
- 物件名（text、必須）
- 施工住所（text、任意）
- 担当者（text、任意、未指定時 `吉野博`）
- 目標粗利率（number、任意、未指定時 `0.25`）

### 成功時挙動

- 案件IDを採番
- 案件詳細画面へ遷移
- 通知: `案件を作成しました (P-xxx)`

## S-02 見積書PDF出力

### 入力項目

- 案件ID（または案件名）

### 成功時挙動

- `見積書_<案件名>_yyyymmdd.pdf` をダウンロード
- 履歴に出力記録を保存

## S-03 領収書PDF出力

### 入力項目

- 請求ID

### 成功時挙動

- `領収書_<請求ID>_yyyymmdd.pdf` をダウンロード
- 履歴に出力記録を保存

## 3. API設計

## A-01 顧客一覧取得

- `GET /api/v1/customers`

### Response 200

```json
[
  {
    "customer_id": "C-001",
    "customer_name": "矢島不動産管理株式会社",
    "contact_name": "山本店長",
    "status": "アクティブ"
  }
]
```

## A-02 案件作成

- `POST /api/v1/projects`

### Request

```json
{
  "customer_id": "C-001",
  "project_name": "吉野様邸 キッチン",
  "site_address": "東京都江戸川区...",
  "owner_name": "吉野博",
  "target_margin_rate": 0.25
}
```

### Response 201

```json
{
  "project_id": "P-021",
  "project_sheet_name": "P-021_吉野様邸 キッチン",
  "customer_id": "C-001",
  "customer_name": "矢島不動産管理株式会社",
  "project_status": "①リード",
  "created_at": "2026-02-17"
}
```

### Validation

- `customer_id` 必須
- `project_name` 必須
- `target_margin_rate` は 0 より大きい数値（未指定時 0.25）

## A-03 案件一覧取得

- `GET /api/v1/projects?status=...&customer_id=...`

### Response 200

```json
{
  "items": [
    {
      "project_id": "P-003",
      "project_name": "吉野様邸キッチン",
      "customer_id": "C-001",
      "customer_name": "矢島不動産管理株式会社",
      "quote_amount": 1254440,
      "budget_amount": 950000,
      "gross_margin_rate": 0.2426,
      "project_status": "⑦完工"
    }
  ],
  "total": 1
}
```

## A-04 見積書PDF生成

- `POST /api/v1/documents/estimate-cover`

### Request

```json
{
  "project_id": "P-003"
}
```

### Response 200

- `application/pdf` バイナリ
- `Content-Disposition: attachment; filename="見積書_吉野様邸キッチン_20260217.pdf"`

### Validation

- `project_id` 必須
- 該当案件が存在しない場合 `404`

## A-05 領収書PDF生成

- `POST /api/v1/documents/receipt`

### Request

```json
{
  "invoice_id": "INV-001"
}
```

### Response 200

- `application/pdf` バイナリ
- `Content-Disposition: attachment; filename="領収書_INV-001_20260217.pdf"`

### Validation

- `invoice_id` 必須
- 該当請求が存在しない場合 `404`

## 4. Excel互換マッピング

| アプリ項目 | Excel対応 |
|---|---|
| `project_id` | 案件管理!A |
| `customer_id` | 案件管理!B / 顧客マスタ!A |
| `customer_name` | 案件管理!C / 顧客マスタ!C |
| `project_name` | 案件管理!D |
| `site_address` | 案件管理!AE |
| `owner_name` | 案件管理!M |
| `target_margin_rate` | 案件シート!B7 |
| 見積書PDF | Ｓ表紙出力 |
| 領収書PDF | 領収書出力 |

## 5. 受入基準（MVP）

- A-02で案件作成後、`project_id` が重複しない
- A-04で見積書PDFが命名規則通り出力される
- A-05で領収書PDFが命名規則通り出力される
- 同一案件の主要値（案件ID/顧客名/金額）がExcel結果と一致する

