# APP移行検討メモ (2026-02-17)

## 1. 結論（先に要点）

- Excelに親和性があるのは正しいが、**Excel必須ではない**。
- 現在のGitHub資産を流用して、Webアプリ（またはデスクトップアプリ）化は可能。
- ただし現リポジトリは **Excel/VBA中心** で、アプリ実装コードは未存在。
- したがって、最適解は「Excel運用を止めずに、段階的にアプリへ移行」。

## 2. 現状確認（リポジトリ実態）

現行の主要資産:

- `excel/見積原価管理システム.xlsx`
- `excel/見積原価管理システム.xlsm`
- `vba/Module_NewProject.bas`
- `scripts/build_workbook.py`
- `scripts/validate_workbook.py`

未存在（= これから作る必要があるもの）:

- Webフロントエンド（React/Next.js等）
- APIサーバー（FastAPI/Node等）
- DBスキーマ/マイグレーション
- 認証・権限管理

## 3. 既存資産の再利用ポイント

### 3.1 業務ロジック再利用

- `新規案件作成` の入力契約
  - 顧客ID、担当者、目標粗利率
- 案件ID採番規則
  - `P-001` 形式、最大ID+1
- PDF命名規則
  - `見積書_案件名_yyyymmdd.pdf` 等
- 禁則文字サニタイズ
  - シート名・ファイル名の安全化

### 3.2 データモデル再利用

- `案件管理` を中心に、以下をテーブル化
  - 案件
  - 顧客
  - 業者
  - 工事項目
  - 請求
  - 支払

### 3.3 検証資産再利用

- `scripts/validate_workbook.py` のチェック観点を、
  アプリ側の回帰テスト観点に転用可能。

## 4. 「Excel親和性」を落とさないアプリ設計

### 4.1 UI原則

- Excelライクな表入力（行追加、コピー/貼付け、キーボード操作）
- セル単位編集感覚（Tab/Enter移動）
- フィルタ・並び替え・簡易集計を標準搭載

### 4.2 必須機能（Excel代替の最小単位）

1. 新規案件作成（自動採番）
2. 見積明細入力（カテゴリ/項目/数量/単価）
3. S表紙PDF出力
4. 領収書PDF出力
5. 発注書PDF出力

### 4.3 互換性機能（Excelとの共存）

- Excel入出力（.xlsx export/import）
- 既存帳票フォーマットに寄せたPDFテンプレート
- 既存ID体系（P-xxx, C-xxx, V-xxx）維持

## 5. 推奨アプローチ（段階移行）

## Phase A: 徹底分析（先行）

- 現行Excelの仕様凍結（入力/出力/計算契約）
- VBAのユースケース分解
- 帳票レイアウトの固定化
- 差分比較用のゴールデンデータ作成（10案件）

成果物:

- 機能一覧（必須/任意）
- データ辞書
- API I/O定義
- 回帰テストケース

## Phase B: MVP実装

- 対象を3機能に限定
  - 新規案件作成
  - S表紙PDF
  - 領収書PDF
- 既存Excelと並行運用
- 出力差分（数値・PDF）を比較

## Phase C: 本移行判断

- 比較結果が基準を満たしたら運用切替
- 満たさない場合はExcel運用継続＋MVP改善

## 6. 受入基準（移行可否の判定軸）

1. 案件作成フローが手作業なしで完走
2. PDF3種のファイル名/金額/レイアウトが許容差内
3. 既存案件データの参照破綻なし
4. ユーザー操作時間がExcel比で悪化しない

## 7. 主要リスクと対策

- リスク: 数式互換差（丸め、税計算）
  - 対策: Excel結果を正とした差分テスト自動化
- リスク: 帳票レイアウト差
  - 対策: PDFピクセル差分ではなく項目差分+目視承認
- リスク: 現場の操作感ギャップ
  - 対策: ExcelライクUI部品を先行プロトタイプ

## 8. 次アクション（提案）

1. 分析フェーズを先に完了（実装はまだ着手しない）
2. 仕様凍結ドキュメントを作成
3. MVP対象3機能の画面/API設計を確定
4. 合意後に実装開始

## 9. Phase 0 作成済み成果物

- `docs/機能仕様凍結.md`
- `docs/データ辞書.md`
- `docs/PDF仕様.md`
- `docs/MVP画面API設計_20260217.md`
